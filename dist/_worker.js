var Hr=Object.defineProperty;var Ct=e=>{throw TypeError(e)};var Ir=(e,t,r)=>t in e?Hr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var g=(e,t,r)=>Ir(e,typeof t!="symbol"?t+"":t,r),nt=(e,t,r)=>t.has(e)||Ct("Cannot "+r);var c=(e,t,r)=>(nt(e,t,"read from private field"),r?r.call(e):t.get(e)),b=(e,t,r)=>t.has(e)?Ct("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,r),y=(e,t,r,n)=>(nt(e,t,"write to private field"),n?n.call(e,r):t.set(e,r),r),A=(e,t,r)=>(nt(e,t,"access private method"),r);var Ot=(e,t,r,n)=>({set _(s){y(e,t,s,r)},get _(){return c(e,t,n)}});var er={Stringify:1},_=(e,t)=>{const r=new String(e);return r.isEscaped=!0,r.callbacks=t,r},Fr=/[&<>'"]/,tr=async(e,t)=>{let r="";t||(t=[]);const n=await Promise.all(e);for(let s=n.length-1;r+=n[s],s--,!(s<0);s--){let i=n[s];typeof i=="object"&&t.push(...i.callbacks||[]);const a=i.isEscaped;if(i=await(typeof i=="object"?i.toString():i),typeof i=="object"&&t.push(...i.callbacks||[]),i.isEscaped??a)r+=i;else{const o=[r];te(i,o),r=o[0]}}return _(r,t)},te=(e,t)=>{const r=e.search(Fr);if(r===-1){t[0]+=e;return}let n,s,i=0;for(s=r;s<e.length;s++){switch(e.charCodeAt(s)){case 34:n="&quot;";break;case 39:n="&#39;";break;case 38:n="&amp;";break;case 60:n="&lt;";break;case 62:n="&gt;";break;default:continue}t[0]+=e.substring(i,s)+n,i=s+1}t[0]+=e.substring(i,s)},rr=e=>{const t=e.callbacks;if(!(t!=null&&t.length))return e;const r=[e],n={};return t.forEach(s=>s({phase:er.Stringify,buffer:r,context:n})),r[0]},nr=async(e,t,r,n,s)=>{typeof e=="object"&&!(e instanceof String)&&(e instanceof Promise||(e=e.toString()),e instanceof Promise&&(e=await e));const i=e.callbacks;return i!=null&&i.length?(s?s[0]+=e:s=[e],Promise.all(i.map(o=>o({phase:t,buffer:s,context:n}))).then(o=>Promise.all(o.filter(Boolean).map(l=>nr(l,t,!1,n,s))).then(()=>s[0]))):Promise.resolve(e)},qr=(e,...t)=>{const r=[""];for(let n=0,s=e.length-1;n<s;n++){r[0]+=e[n];const i=Array.isArray(t[n])?t[n].flat(1/0):[t[n]];for(let a=0,o=i.length;a<o;a++){const l=i[a];if(typeof l=="string")te(l,r);else if(typeof l=="number")r[0]+=l;else{if(typeof l=="boolean"||l===null||l===void 0)continue;if(typeof l=="object"&&l.isEscaped)if(l.callbacks)r.unshift("",l);else{const u=l.toString();u instanceof Promise?r.unshift("",u):r[0]+=u}else l instanceof Promise?r.unshift("",l):te(l.toString(),r)}}}return r[0]+=e.at(-1),r.length===1?"callbacks"in r?_(rr(_(r[0],r.callbacks))):_(r[0]):tr(r,r.callbacks)},Et=Symbol("RENDERER"),dt=Symbol("ERROR_HANDLER"),O=Symbol("STASH"),sr=Symbol("INTERNAL"),Br=Symbol("MEMO"),Ze=Symbol("PERMALINK"),kt=e=>(e[sr]=!0,e),ir=e=>({value:t,children:r})=>{if(!r)return;const n={children:[{tag:kt(()=>{e.push(t)}),props:{}}]};Array.isArray(r)?n.children.push(...r.flat()):n.children.push(r),n.children.push({tag:kt(()=>{e.pop()}),props:{}});const s={tag:"",props:n,type:""};return s[dt]=i=>{throw e.pop(),i},s},ar=e=>{const t=[e],r=ir(t);return r.values=t,r.Provider=r,be.push(r),r},be=[],wt=e=>{const t=[e],r=n=>{t.push(n.value);let s;try{s=n.children?(Array.isArray(n.children)?new ur("",{},n.children):n.children).toString():""}finally{t.pop()}return s instanceof Promise?s.then(i=>_(i,i.callbacks)):_(s)};return r.values=t,r.Provider=r,r[Et]=ir(t),be.push(r),r},xe=e=>e.values.at(-1),Ue={title:[],script:["src"],style:["data-href"],link:["href"],meta:["name","httpEquiv","charset","itemProp"]},vt={},We="data-precedence",De=e=>Array.isArray(e)?e:[e],Pt=new WeakMap,jt=(e,t,r,n)=>({buffer:s,context:i})=>{if(!s)return;const a=Pt.get(i)||{};Pt.set(i,a);const o=a[e]||(a[e]=[]);let l=!1;const u=Ue[e];if(u.length>0){e:for(const[,f]of o)for(const d of u)if(((f==null?void 0:f[d])??null)===(r==null?void 0:r[d])){l=!0;break e}}if(l?s[0]=s[0].replaceAll(t,""):u.length>0?o.push([t,r,n]):o.unshift([t,r,n]),s[0].indexOf("</head>")!==-1){let f;if(n===void 0)f=o.map(([d])=>d);else{const d=[];f=o.map(([h,,m])=>{let E=d.indexOf(m);return E===-1&&(d.push(m),E=d.length-1),[h,E]}).sort((h,m)=>h[1]-m[1]).map(([h])=>h)}f.forEach(d=>{s[0]=s[0].replaceAll(d,"")}),s[0]=s[0].replace(/(?=<\/head>)/,f.join(""))}},He=(e,t,r)=>_(new I(e,r,De(t??[])).toString()),Ie=(e,t,r,n)=>{if("itemProp"in r)return He(e,t,r);let{precedence:s,blocking:i,...a}=r;s=n?s??"":void 0,n&&(a[We]=s);const o=new I(e,a,De(t||[])).toString();return o instanceof Promise?o.then(l=>_(o,[...l.callbacks||[],jt(e,l,a,s)])):_(o,[jt(e,o,a,s)])},Ur=({children:e,...t})=>{const r=bt();if(r){const n=xe(r);if(n==="svg"||n==="head")return new I("title",t,De(e??[]))}return Ie("title",e,t,!1)},Wr=({children:e,...t})=>{const r=bt();return["src","async"].some(n=>!t[n])||r&&xe(r)==="head"?He("script",e,t):Ie("script",e,t,!1)},Kr=({children:e,...t})=>["href","precedence"].every(r=>r in t)?(t["data-href"]=t.href,delete t.href,Ie("style",e,t,!0)):He("style",e,t),Vr=({children:e,...t})=>["onLoad","onError"].some(r=>r in t)||t.rel==="stylesheet"&&(!("precedence"in t)||"disabled"in t)?He("link",e,t):Ie("link",e,t,"precedence"in t),zr=({children:e,...t})=>{const r=bt();return r&&xe(r)==="head"?He("meta",e,t):Ie("meta",e,t,!1)},or=(e,{children:t,...r})=>new I(e,r,De(t??[])),Gr=e=>(typeof e.action=="function"&&(e.action=Ze in e.action?e.action[Ze]:void 0),or("form",e)),lr=(e,t)=>(typeof t.formAction=="function"&&(t.formAction=Ze in t.formAction?t.formAction[Ze]:void 0),or(e,t)),Xr=e=>lr("input",e),Jr=e=>lr("button",e);const st=Object.freeze(Object.defineProperty({__proto__:null,button:Jr,form:Gr,input:Xr,link:Vr,meta:zr,script:Wr,style:Kr,title:Ur},Symbol.toStringTag,{value:"Module"}));var Zr=new Map([["className","class"],["htmlFor","for"],["crossOrigin","crossorigin"],["httpEquiv","http-equiv"],["itemProp","itemprop"],["fetchPriority","fetchpriority"],["noModule","nomodule"],["formAction","formaction"]]),Ye=e=>Zr.get(e)||e,cr=(e,t)=>{for(const[r,n]of Object.entries(e)){const s=r[0]==="-"||!/[A-Z]/.test(r)?r:r.replace(/[A-Z]/g,i=>`-${i.toLowerCase()}`);t(s,n==null?null:typeof n=="number"?s.match(/^(?:a|border-im|column(?:-c|s)|flex(?:$|-[^b])|grid-(?:ar|[^a])|font-w|li|or|sca|st|ta|wido|z)|ty$/)?`${n}`:`${n}px`:n)}},ke=void 0,bt=()=>ke,Yr=e=>/[A-Z]/.test(e)&&e.match(/^(?:al|basel|clip(?:Path|Rule)$|co|do|fill|fl|fo|gl|let|lig|i|marker[EMS]|o|pai|pointe|sh|st[or]|text[^L]|tr|u|ve|w)/)?e.replace(/([A-Z])/g,"-$1").toLowerCase():e,Qr=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],en=["allowfullscreen","async","autofocus","autoplay","checked","controls","default","defer","disabled","download","formnovalidate","hidden","inert","ismap","itemscope","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","selected"],Rt=(e,t)=>{for(let r=0,n=e.length;r<n;r++){const s=e[r];if(typeof s=="string")te(s,t);else{if(typeof s=="boolean"||s===null||s===void 0)continue;s instanceof I?s.toStringToBuffer(t):typeof s=="number"||s.isEscaped?t[0]+=s:s instanceof Promise?t.unshift("",s):Rt(s,t)}}},I=class{constructor(e,t,r){g(this,"tag");g(this,"props");g(this,"key");g(this,"children");g(this,"isEscaped",!0);g(this,"localContexts");this.tag=e,this.props=t,this.children=r}get type(){return this.tag}get ref(){return this.props.ref||null}toString(){var t,r;const e=[""];(t=this.localContexts)==null||t.forEach(([n,s])=>{n.values.push(s)});try{this.toStringToBuffer(e)}finally{(r=this.localContexts)==null||r.forEach(([n])=>{n.values.pop()})}return e.length===1?"callbacks"in e?rr(_(e[0],e.callbacks)).toString():e[0]:tr(e,e.callbacks)}toStringToBuffer(e){const t=this.tag,r=this.props;let{children:n}=this;e[0]+=`<${t}`;const s=ke&&xe(ke)==="svg"?i=>Yr(Ye(i)):i=>Ye(i);for(let[i,a]of Object.entries(r))if(i=s(i),i!=="children"){if(i==="style"&&typeof a=="object"){let o="";cr(a,(l,u)=>{u!=null&&(o+=`${o?";":""}${l}:${u}`)}),e[0]+=' style="',te(o,e),e[0]+='"'}else if(typeof a=="string")e[0]+=` ${i}="`,te(a,e),e[0]+='"';else if(a!=null)if(typeof a=="number"||a.isEscaped)e[0]+=` ${i}="${a}"`;else if(typeof a=="boolean"&&en.includes(i))a&&(e[0]+=` ${i}=""`);else if(i==="dangerouslySetInnerHTML"){if(n.length>0)throw new Error("Can only set one of `children` or `props.dangerouslySetInnerHTML`.");n=[_(a.__html)]}else if(a instanceof Promise)e[0]+=` ${i}="`,e.unshift('"',a);else if(typeof a=="function"){if(!i.startsWith("on")&&i!=="ref")throw new Error(`Invalid prop '${i}' of type 'function' supplied to '${t}'.`)}else e[0]+=` ${i}="`,te(a.toString(),e),e[0]+='"'}if(Qr.includes(t)&&n.length===0){e[0]+="/>";return}e[0]+=">",Rt(n,e),e[0]+=`</${t}>`}},it=class extends I{toStringToBuffer(e){const{children:t}=this,r={...this.props};t.length&&(r.children=t.length===1?t[0]:t);const n=this.tag.call(null,r);if(!(typeof n=="boolean"||n==null))if(n instanceof Promise)if(be.length===0)e.unshift("",n);else{const s=be.map(i=>[i,i.values.at(-1)]);e.unshift("",n.then(i=>(i instanceof I&&(i.localContexts=s),i)))}else n instanceof I?n.toStringToBuffer(e):typeof n=="number"||n.isEscaped?(e[0]+=n,n.callbacks&&(e.callbacks||(e.callbacks=[]),e.callbacks.push(...n.callbacks))):te(n,e)}},ur=class extends I{toStringToBuffer(e){Rt(this.children,e)}},Tt=(e,t,...r)=>{t??(t={}),r.length&&(t.children=r.length===1?r[0]:r);const n=t.key;delete t.key;const s=Ke(e,t,r);return s.key=n,s},Nt=!1,Ke=(e,t,r)=>{if(!Nt){for(const n in vt)st[n][Et]=vt[n];Nt=!0}return typeof e=="function"?new it(e,t,r):st[e]?new it(st[e],t,r):e==="svg"||e==="head"?(ke||(ke=wt("")),new I(e,t,[new it(ke,{value:e},r)])):new I(e,t,r)},tn=({children:e})=>new ur("",{children:e},Array.isArray(e)?e:e?[e]:[]);function v(e,t,r){let n;if(!t||!("children"in t))n=Ke(e,t,[]);else{const s=t.children;n=Array.isArray(s)?Ke(e,t,s):Ke(e,t,[s])}return n.key=r,n}var $t=(e,t,r)=>(n,s)=>{let i=-1;return a(0);async function a(o){if(o<=i)throw new Error("next() called multiple times");i=o;let l,u=!1,f;if(e[o]?(f=e[o][0][0],n.req.routeIndex=o):f=o===e.length&&s||void 0,f)try{l=await f(n,()=>a(o+1))}catch(d){if(d instanceof Error&&t)n.error=d,l=await t(d,n),u=!0;else throw d}else n.finalized===!1&&r&&(l=await r(n));return l&&(n.finalized===!1||u)&&(n.res=l),n}},rn=Symbol(),nn=async(e,t=Object.create(null))=>{const{all:r=!1,dot:n=!1}=t,i=(e instanceof mr?e.raw.headers:e.headers).get("Content-Type");return i!=null&&i.startsWith("multipart/form-data")||i!=null&&i.startsWith("application/x-www-form-urlencoded")?sn(e,{all:r,dot:n}):{}};async function sn(e,t){const r=await e.formData();return r?an(r,t):{}}function an(e,t){const r=Object.create(null);return e.forEach((n,s)=>{t.all||s.endsWith("[]")?on(r,s,n):r[s]=n}),t.dot&&Object.entries(r).forEach(([n,s])=>{n.includes(".")&&(ln(r,n,s),delete r[n])}),r}var on=(e,t,r)=>{e[t]!==void 0?Array.isArray(e[t])?e[t].push(r):e[t]=[e[t],r]:t.endsWith("[]")?e[t]=[r]:e[t]=r},ln=(e,t,r)=>{let n=e;const s=t.split(".");s.forEach((i,a)=>{a===s.length-1?n[i]=r:((!n[i]||typeof n[i]!="object"||Array.isArray(n[i])||n[i]instanceof File)&&(n[i]=Object.create(null)),n=n[i])})},fr=e=>{const t=e.split("/");return t[0]===""&&t.shift(),t},cn=e=>{const{groups:t,path:r}=un(e),n=fr(r);return fn(n,t)},un=e=>{const t=[];return e=e.replace(/\{[^}]+\}/g,(r,n)=>{const s=`@${n}`;return t.push([s,r]),s}),{groups:t,path:e}},fn=(e,t)=>{for(let r=t.length-1;r>=0;r--){const[n]=t[r];for(let s=e.length-1;s>=0;s--)if(e[s].includes(n)){e[s]=e[s].replace(n,t[r][1]);break}}return e},qe={},hn=(e,t)=>{if(e==="*")return"*";const r=e.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);if(r){const n=`${e}#${t}`;return qe[n]||(r[2]?qe[n]=t&&t[0]!==":"&&t[0]!=="*"?[n,r[1],new RegExp(`^${r[2]}(?=/${t})`)]:[e,r[1],new RegExp(`^${r[2]}$`)]:qe[n]=[e,r[1],!0]),qe[n]}return null},xt=(e,t)=>{try{return t(e)}catch{return e.replace(/(?:%[0-9A-Fa-f]{2})+/g,r=>{try{return t(r)}catch{return r}})}},dn=e=>xt(e,decodeURI),hr=e=>{const t=e.url,r=t.indexOf("/",t.indexOf(":")+4);let n=r;for(;n<t.length;n++){const s=t.charCodeAt(n);if(s===37){const i=t.indexOf("?",n),a=t.slice(r,i===-1?void 0:i);return dn(a.includes("%25")?a.replace(/%25/g,"%2525"):a)}else if(s===63)break}return t.slice(r,n)},vn=e=>{const t=hr(e);return t.length>1&&t.at(-1)==="/"?t.slice(0,-1):t},de=(e,t,...r)=>(r.length&&(t=de(t,...r)),`${(e==null?void 0:e[0])==="/"?"":"/"}${e}${t==="/"?"":`${(e==null?void 0:e.at(-1))==="/"?"":"/"}${(t==null?void 0:t[0])==="/"?t.slice(1):t}`}`),dr=e=>{if(e.charCodeAt(e.length-1)!==63||!e.includes(":"))return null;const t=e.split("/"),r=[];let n="";return t.forEach(s=>{if(s!==""&&!/\:/.test(s))n+="/"+s;else if(/\:/.test(s))if(/\?/.test(s)){r.length===0&&n===""?r.push("/"):r.push(n);const i=s.replace("?","");n+="/"+i,r.push(n)}else n+="/"+s}),r.filter((s,i,a)=>a.indexOf(s)===i)},at=e=>/[%+]/.test(e)?(e.indexOf("+")!==-1&&(e=e.replace(/\+/g," ")),e.indexOf("%")!==-1?xt(e,pr):e):e,vr=(e,t,r)=>{let n;if(!r&&t&&!/[%+]/.test(t)){let a=e.indexOf("?",8);if(a===-1)return;for(e.startsWith(t,a+1)||(a=e.indexOf(`&${t}`,a+1));a!==-1;){const o=e.charCodeAt(a+t.length+1);if(o===61){const l=a+t.length+2,u=e.indexOf("&",l);return at(e.slice(l,u===-1?void 0:u))}else if(o==38||isNaN(o))return"";a=e.indexOf(`&${t}`,a+1)}if(n=/[%+]/.test(e),!n)return}const s={};n??(n=/[%+]/.test(e));let i=e.indexOf("?",8);for(;i!==-1;){const a=e.indexOf("&",i+1);let o=e.indexOf("=",i);o>a&&a!==-1&&(o=-1);let l=e.slice(i+1,o===-1?a===-1?void 0:a:o);if(n&&(l=at(l)),i=a,l==="")continue;let u;o===-1?u="":(u=e.slice(o+1,a===-1?void 0:a),n&&(u=at(u))),r?(s[l]&&Array.isArray(s[l])||(s[l]=[]),s[l].push(u)):s[l]??(s[l]=u)}return t?s[t]:s},pn=vr,mn=(e,t)=>vr(e,t,!0),pr=decodeURIComponent,Lt=e=>xt(e,pr),me,L,V,gr,yr,pt,X,Kt,mr=(Kt=class{constructor(e,t="/",r=[[]]){b(this,V);g(this,"raw");b(this,me);b(this,L);g(this,"routeIndex",0);g(this,"path");g(this,"bodyCache",{});b(this,X,e=>{const{bodyCache:t,raw:r}=this,n=t[e];if(n)return n;const s=Object.keys(t)[0];return s?t[s].then(i=>(s==="json"&&(i=JSON.stringify(i)),new Response(i)[e]())):t[e]=r[e]()});this.raw=e,this.path=t,y(this,L,r),y(this,me,{})}param(e){return e?A(this,V,gr).call(this,e):A(this,V,yr).call(this)}query(e){return pn(this.url,e)}queries(e){return mn(this.url,e)}header(e){if(e)return this.raw.headers.get(e)??void 0;const t={};return this.raw.headers.forEach((r,n)=>{t[n]=r}),t}async parseBody(e){var t;return(t=this.bodyCache).parsedBody??(t.parsedBody=await nn(this,e))}json(){return c(this,X).call(this,"text").then(e=>JSON.parse(e))}text(){return c(this,X).call(this,"text")}arrayBuffer(){return c(this,X).call(this,"arrayBuffer")}blob(){return c(this,X).call(this,"blob")}formData(){return c(this,X).call(this,"formData")}addValidatedData(e,t){c(this,me)[e]=t}valid(e){return c(this,me)[e]}get url(){return this.raw.url}get method(){return this.raw.method}get[rn](){return c(this,L)}get matchedRoutes(){return c(this,L)[0].map(([[,e]])=>e)}get routePath(){return c(this,L)[0].map(([[,e]])=>e)[this.routeIndex].path}},me=new WeakMap,L=new WeakMap,V=new WeakSet,gr=function(e){const t=c(this,L)[0][this.routeIndex][1][e],r=A(this,V,pt).call(this,t);return r&&/\%/.test(r)?Lt(r):r},yr=function(){const e={},t=Object.keys(c(this,L)[0][this.routeIndex][1]);for(const r of t){const n=A(this,V,pt).call(this,c(this,L)[0][this.routeIndex][1][r]);n!==void 0&&(e[r]=/\%/.test(n)?Lt(n):n)}return e},pt=function(e){return c(this,L)[1]?c(this,L)[1][e]:e},X=new WeakMap,Kt),gn="text/plain; charset=UTF-8",ot=(e,t)=>({"Content-Type":e,...t}),Te,Ne,B,ge,U,$,$e,ye,Ee,ie,Le,_e,J,ve,Vt,yn=(Vt=class{constructor(e,t){b(this,J);b(this,Te);b(this,Ne);g(this,"env",{});b(this,B);g(this,"finalized",!1);g(this,"error");b(this,ge);b(this,U);b(this,$);b(this,$e);b(this,ye);b(this,Ee);b(this,ie);b(this,Le);b(this,_e);g(this,"render",(...e)=>(c(this,ye)??y(this,ye,t=>this.html(t)),c(this,ye).call(this,...e)));g(this,"setLayout",e=>y(this,$e,e));g(this,"getLayout",()=>c(this,$e));g(this,"setRenderer",e=>{y(this,ye,e)});g(this,"header",(e,t,r)=>{this.finalized&&y(this,$,new Response(c(this,$).body,c(this,$)));const n=c(this,$)?c(this,$).headers:c(this,ie)??y(this,ie,new Headers);t===void 0?n.delete(e):r!=null&&r.append?n.append(e,t):n.set(e,t)});g(this,"status",e=>{y(this,ge,e)});g(this,"set",(e,t)=>{c(this,B)??y(this,B,new Map),c(this,B).set(e,t)});g(this,"get",e=>c(this,B)?c(this,B).get(e):void 0);g(this,"newResponse",(...e)=>A(this,J,ve).call(this,...e));g(this,"body",(e,t,r)=>A(this,J,ve).call(this,e,t,r));g(this,"text",(e,t,r)=>!c(this,ie)&&!c(this,ge)&&!t&&!r&&!this.finalized?new Response(e):A(this,J,ve).call(this,e,t,ot(gn,r)));g(this,"json",(e,t,r)=>A(this,J,ve).call(this,JSON.stringify(e),t,ot("application/json",r)));g(this,"html",(e,t,r)=>{const n=s=>A(this,J,ve).call(this,s,t,ot("text/html; charset=UTF-8",r));return typeof e=="object"?nr(e,er.Stringify,!1,{}).then(n):n(e)});g(this,"redirect",(e,t)=>{const r=String(e);return this.header("Location",/[^\x00-\xFF]/.test(r)?encodeURI(r):r),this.newResponse(null,t??302)});g(this,"notFound",()=>(c(this,Ee)??y(this,Ee,()=>new Response),c(this,Ee).call(this,this)));y(this,Te,e),t&&(y(this,U,t.executionCtx),this.env=t.env,y(this,Ee,t.notFoundHandler),y(this,_e,t.path),y(this,Le,t.matchResult))}get req(){return c(this,Ne)??y(this,Ne,new mr(c(this,Te),c(this,_e),c(this,Le))),c(this,Ne)}get event(){if(c(this,U)&&"respondWith"in c(this,U))return c(this,U);throw Error("This context has no FetchEvent")}get executionCtx(){if(c(this,U))return c(this,U);throw Error("This context has no ExecutionContext")}get res(){return c(this,$)||y(this,$,new Response(null,{headers:c(this,ie)??y(this,ie,new Headers)}))}set res(e){if(c(this,$)&&e){e=new Response(e.body,e);for(const[t,r]of c(this,$).headers.entries())if(t!=="content-type")if(t==="set-cookie"){const n=c(this,$).headers.getSetCookie();e.headers.delete("set-cookie");for(const s of n)e.headers.append("set-cookie",s)}else e.headers.set(t,r)}y(this,$,e),this.finalized=!0}get var(){return c(this,B)?Object.fromEntries(c(this,B)):{}}},Te=new WeakMap,Ne=new WeakMap,B=new WeakMap,ge=new WeakMap,U=new WeakMap,$=new WeakMap,$e=new WeakMap,ye=new WeakMap,Ee=new WeakMap,ie=new WeakMap,Le=new WeakMap,_e=new WeakMap,J=new WeakSet,ve=function(e,t,r){const n=c(this,$)?new Headers(c(this,$).headers):c(this,ie)??new Headers;if(typeof t=="object"&&"headers"in t){const i=t.headers instanceof Headers?t.headers:new Headers(t.headers);for(const[a,o]of i)a.toLowerCase()==="set-cookie"?n.append(a,o):n.set(a,o)}if(r)for(const[i,a]of Object.entries(r))if(typeof a=="string")n.set(i,a);else{n.delete(i);for(const o of a)n.append(i,o)}const s=typeof t=="number"?t:(t==null?void 0:t.status)??c(this,ge);return new Response(e,{status:s,headers:n})},Vt),k="ALL",En="all",wn=["get","post","put","delete","options","patch"],Er="Can not add a route since the matcher is already built.",wr=class extends Error{},bn="__COMPOSED_HANDLER",Rn=e=>e.text("404 Not Found",404),_t=(e,t)=>{if("getResponse"in e){const r=e.getResponse();return t.newResponse(r.body,r)}return console.error(e),t.text("Internal Server Error",500)},M,P,Rr,D,ne,Ve,ze,zt,br=(zt=class{constructor(t={}){b(this,P);g(this,"get");g(this,"post");g(this,"put");g(this,"delete");g(this,"options");g(this,"patch");g(this,"all");g(this,"on");g(this,"use");g(this,"router");g(this,"getPath");g(this,"_basePath","/");b(this,M,"/");g(this,"routes",[]);b(this,D,Rn);g(this,"errorHandler",_t);g(this,"onError",t=>(this.errorHandler=t,this));g(this,"notFound",t=>(y(this,D,t),this));g(this,"fetch",(t,...r)=>A(this,P,ze).call(this,t,r[1],r[0],t.method));g(this,"request",(t,r,n,s)=>t instanceof Request?this.fetch(r?new Request(t,r):t,n,s):(t=t.toString(),this.fetch(new Request(/^https?:\/\//.test(t)?t:`http://localhost${de("/",t)}`,r),n,s)));g(this,"fire",()=>{addEventListener("fetch",t=>{t.respondWith(A(this,P,ze).call(this,t.request,t,void 0,t.request.method))})});[...wn,En].forEach(i=>{this[i]=(a,...o)=>(typeof a=="string"?y(this,M,a):A(this,P,ne).call(this,i,c(this,M),a),o.forEach(l=>{A(this,P,ne).call(this,i,c(this,M),l)}),this)}),this.on=(i,a,...o)=>{for(const l of[a].flat()){y(this,M,l);for(const u of[i].flat())o.map(f=>{A(this,P,ne).call(this,u.toUpperCase(),c(this,M),f)})}return this},this.use=(i,...a)=>(typeof i=="string"?y(this,M,i):(y(this,M,"*"),a.unshift(i)),a.forEach(o=>{A(this,P,ne).call(this,k,c(this,M),o)}),this);const{strict:n,...s}=t;Object.assign(this,s),this.getPath=n??!0?t.getPath??hr:vn}route(t,r){const n=this.basePath(t);return r.routes.map(s=>{var a;let i;r.errorHandler===_t?i=s.handler:(i=async(o,l)=>(await $t([],r.errorHandler)(o,()=>s.handler(o,l))).res,i[bn]=s.handler),A(a=n,P,ne).call(a,s.method,s.path,i)}),this}basePath(t){const r=A(this,P,Rr).call(this);return r._basePath=de(this._basePath,t),r}mount(t,r,n){let s,i;n&&(typeof n=="function"?i=n:(i=n.optionHandler,n.replaceRequest===!1?s=l=>l:s=n.replaceRequest));const a=i?l=>{const u=i(l);return Array.isArray(u)?u:[u]}:l=>{let u;try{u=l.executionCtx}catch{}return[l.env,u]};s||(s=(()=>{const l=de(this._basePath,t),u=l==="/"?0:l.length;return f=>{const d=new URL(f.url);return d.pathname=d.pathname.slice(u)||"/",new Request(d,f)}})());const o=async(l,u)=>{const f=await r(s(l.req.raw),...a(l));if(f)return f;await u()};return A(this,P,ne).call(this,k,de(t,"*"),o),this}},M=new WeakMap,P=new WeakSet,Rr=function(){const t=new br({router:this.router,getPath:this.getPath});return t.errorHandler=this.errorHandler,y(t,D,c(this,D)),t.routes=this.routes,t},D=new WeakMap,ne=function(t,r,n){t=t.toUpperCase(),r=de(this._basePath,r);const s={basePath:this._basePath,path:r,method:t,handler:n};this.router.add(t,r,[n,s]),this.routes.push(s)},Ve=function(t,r){if(t instanceof Error)return this.errorHandler(t,r);throw t},ze=function(t,r,n,s){if(s==="HEAD")return(async()=>new Response(null,await A(this,P,ze).call(this,t,r,n,"GET")))();const i=this.getPath(t,{env:n}),a=this.router.match(s,i),o=new yn(t,{path:i,matchResult:a,env:n,executionCtx:r,notFoundHandler:c(this,D)});if(a[0].length===1){let u;try{u=a[0][0][0][0](o,async()=>{o.res=await c(this,D).call(this,o)})}catch(f){return A(this,P,Ve).call(this,f,o)}return u instanceof Promise?u.then(f=>f||(o.finalized?o.res:c(this,D).call(this,o))).catch(f=>A(this,P,Ve).call(this,f,o)):u??c(this,D).call(this,o)}const l=$t(a[0],this.errorHandler,c(this,D));return(async()=>{try{const u=await l(o);if(!u.finalized)throw new Error("Context is not finalized. Did you forget to return a Response object or `await next()`?");return u.res}catch(u){return A(this,P,Ve).call(this,u,o)}})()},zt),xr=[];function xn(e,t){const r=this.buildAllMatchers(),n=(s,i)=>{const a=r[s]||r[k],o=a[2][i];if(o)return o;const l=i.match(a[0]);if(!l)return[[],xr];const u=l.indexOf("",1);return[a[1][u],l]};return this.match=n,n(e,t)}var Qe="[^/]+",Ce=".*",Oe="(?:|/.*)",pe=Symbol(),Sn=new Set(".\\+*[^]$()");function An(e,t){return e.length===1?t.length===1?e<t?-1:1:-1:t.length===1||e===Ce||e===Oe?1:t===Ce||t===Oe?-1:e===Qe?1:t===Qe?-1:e.length===t.length?e<t?-1:1:t.length-e.length}var ae,oe,H,Gt,mt=(Gt=class{constructor(){b(this,ae);b(this,oe);b(this,H,Object.create(null))}insert(t,r,n,s,i){if(t.length===0){if(c(this,ae)!==void 0)throw pe;if(i)return;y(this,ae,r);return}const[a,...o]=t,l=a==="*"?o.length===0?["","",Ce]:["","",Qe]:a==="/*"?["","",Oe]:a.match(/^\:([^\{\}]+)(?:\{(.+)\})?$/);let u;if(l){const f=l[1];let d=l[2]||Qe;if(f&&l[2]&&(d===".*"||(d=d.replace(/^\((?!\?:)(?=[^)]+\)$)/,"(?:"),/\((?!\?:)/.test(d))))throw pe;if(u=c(this,H)[d],!u){if(Object.keys(c(this,H)).some(h=>h!==Ce&&h!==Oe))throw pe;if(i)return;u=c(this,H)[d]=new mt,f!==""&&y(u,oe,s.varIndex++)}!i&&f!==""&&n.push([f,c(u,oe)])}else if(u=c(this,H)[a],!u){if(Object.keys(c(this,H)).some(f=>f.length>1&&f!==Ce&&f!==Oe))throw pe;if(i)return;u=c(this,H)[a]=new mt}u.insert(o,r,n,s,i)}buildRegExpStr(){const r=Object.keys(c(this,H)).sort(An).map(n=>{const s=c(this,H)[n];return(typeof c(s,oe)=="number"?`(${n})@${c(s,oe)}`:Sn.has(n)?`\\${n}`:n)+s.buildRegExpStr()});return typeof c(this,ae)=="number"&&r.unshift(`#${c(this,ae)}`),r.length===0?"":r.length===1?r[0]:"(?:"+r.join("|")+")"}},ae=new WeakMap,oe=new WeakMap,H=new WeakMap,Gt),et,Me,Xt,Cn=(Xt=class{constructor(){b(this,et,{varIndex:0});b(this,Me,new mt)}insert(e,t,r){const n=[],s=[];for(let a=0;;){let o=!1;if(e=e.replace(/\{[^}]+\}/g,l=>{const u=`@\\${a}`;return s[a]=[u,l],a++,o=!0,u}),!o)break}const i=e.match(/(?::[^\/]+)|(?:\/\*$)|./g)||[];for(let a=s.length-1;a>=0;a--){const[o]=s[a];for(let l=i.length-1;l>=0;l--)if(i[l].indexOf(o)!==-1){i[l]=i[l].replace(o,s[a][1]);break}}return c(this,Me).insert(i,t,n,c(this,et),r),n}buildRegExp(){let e=c(this,Me).buildRegExpStr();if(e==="")return[/^$/,[],[]];let t=0;const r=[],n=[];return e=e.replace(/#(\d+)|@(\d+)|\.\*\$/g,(s,i,a)=>i!==void 0?(r[++t]=Number(i),"$()"):(a!==void 0&&(n[Number(a)]=++t),"")),[new RegExp(`^${e}`),r,n]}},et=new WeakMap,Me=new WeakMap,Xt),On=[/^$/,[],Object.create(null)],Ge=Object.create(null);function Sr(e){return Ge[e]??(Ge[e]=new RegExp(e==="*"?"":`^${e.replace(/\/\*$|([.\\+*[^\]$()])/g,(t,r)=>r?`\\${r}`:"(?:|/.*)")}$`))}function kn(){Ge=Object.create(null)}function Pn(e){var u;const t=new Cn,r=[];if(e.length===0)return On;const n=e.map(f=>[!/\*|\/:/.test(f[0]),...f]).sort(([f,d],[h,m])=>f?1:h?-1:d.length-m.length),s=Object.create(null);for(let f=0,d=-1,h=n.length;f<h;f++){const[m,E,p]=n[f];m?s[E]=[p.map(([R])=>[R,Object.create(null)]),xr]:d++;let w;try{w=t.insert(E,d,m)}catch(R){throw R===pe?new wr(E):R}m||(r[d]=p.map(([R,x])=>{const C=Object.create(null);for(x-=1;x>=0;x--){const[S,T]=w[x];C[S]=T}return[R,C]}))}const[i,a,o]=t.buildRegExp();for(let f=0,d=r.length;f<d;f++)for(let h=0,m=r[f].length;h<m;h++){const E=(u=r[f][h])==null?void 0:u[1];if(!E)continue;const p=Object.keys(E);for(let w=0,R=p.length;w<R;w++)E[p[w]]=o[E[p[w]]]}const l=[];for(const f in a)l[f]=r[a[f]];return[i,l,s]}function fe(e,t){if(e){for(const r of Object.keys(e).sort((n,s)=>s.length-n.length))if(Sr(r).test(t))return[...e[r]]}}var Z,Y,tt,Ar,Jt,jn=(Jt=class{constructor(){b(this,tt);g(this,"name","RegExpRouter");b(this,Z);b(this,Y);g(this,"match",xn);y(this,Z,{[k]:Object.create(null)}),y(this,Y,{[k]:Object.create(null)})}add(e,t,r){var o;const n=c(this,Z),s=c(this,Y);if(!n||!s)throw new Error(Er);n[e]||[n,s].forEach(l=>{l[e]=Object.create(null),Object.keys(l[k]).forEach(u=>{l[e][u]=[...l[k][u]]})}),t==="/*"&&(t="*");const i=(t.match(/\/:/g)||[]).length;if(/\*$/.test(t)){const l=Sr(t);e===k?Object.keys(n).forEach(u=>{var f;(f=n[u])[t]||(f[t]=fe(n[u],t)||fe(n[k],t)||[])}):(o=n[e])[t]||(o[t]=fe(n[e],t)||fe(n[k],t)||[]),Object.keys(n).forEach(u=>{(e===k||e===u)&&Object.keys(n[u]).forEach(f=>{l.test(f)&&n[u][f].push([r,i])})}),Object.keys(s).forEach(u=>{(e===k||e===u)&&Object.keys(s[u]).forEach(f=>l.test(f)&&s[u][f].push([r,i]))});return}const a=dr(t)||[t];for(let l=0,u=a.length;l<u;l++){const f=a[l];Object.keys(s).forEach(d=>{var h;(e===k||e===d)&&((h=s[d])[f]||(h[f]=[...fe(n[d],f)||fe(n[k],f)||[]]),s[d][f].push([r,i-u+l+1]))})}}buildAllMatchers(){const e=Object.create(null);return Object.keys(c(this,Y)).concat(Object.keys(c(this,Z))).forEach(t=>{e[t]||(e[t]=A(this,tt,Ar).call(this,t))}),y(this,Z,y(this,Y,void 0)),kn(),e}},Z=new WeakMap,Y=new WeakMap,tt=new WeakSet,Ar=function(e){const t=[];let r=e===k;return[c(this,Z),c(this,Y)].forEach(n=>{const s=n[e]?Object.keys(n[e]).map(i=>[i,n[e][i]]):[];s.length!==0?(r||(r=!0),t.push(...s)):e!==k&&t.push(...Object.keys(n[k]).map(i=>[i,n[k][i]]))}),r?Pn(t):null},Jt),Q,W,Zt,Tn=(Zt=class{constructor(e){g(this,"name","SmartRouter");b(this,Q,[]);b(this,W,[]);y(this,Q,e.routers)}add(e,t,r){if(!c(this,W))throw new Error(Er);c(this,W).push([e,t,r])}match(e,t){if(!c(this,W))throw new Error("Fatal error");const r=c(this,Q),n=c(this,W),s=r.length;let i=0,a;for(;i<s;i++){const o=r[i];try{for(let l=0,u=n.length;l<u;l++)o.add(...n[l]);a=o.match(e,t)}catch(l){if(l instanceof wr)continue;throw l}this.match=o.match.bind(o),y(this,Q,[o]),y(this,W,void 0);break}if(i===s)throw new Error("Fatal error");return this.name=`SmartRouter + ${this.activeRouter.name}`,a}get activeRouter(){if(c(this,W)||c(this,Q).length!==1)throw new Error("No active router has been determined yet.");return c(this,Q)[0]}},Q=new WeakMap,W=new WeakMap,Zt),Se=Object.create(null),ee,N,le,we,j,K,se,Yt,Cr=(Yt=class{constructor(e,t,r){b(this,K);b(this,ee);b(this,N);b(this,le);b(this,we,0);b(this,j,Se);if(y(this,N,r||Object.create(null)),y(this,ee,[]),e&&t){const n=Object.create(null);n[e]={handler:t,possibleKeys:[],score:0},y(this,ee,[n])}y(this,le,[])}insert(e,t,r){y(this,we,++Ot(this,we)._);let n=this;const s=cn(t),i=[];for(let a=0,o=s.length;a<o;a++){const l=s[a],u=s[a+1],f=hn(l,u),d=Array.isArray(f)?f[0]:l;if(d in c(n,N)){n=c(n,N)[d],f&&i.push(f[1]);continue}c(n,N)[d]=new Cr,f&&(c(n,le).push(f),i.push(f[1])),n=c(n,N)[d]}return c(n,ee).push({[e]:{handler:r,possibleKeys:i.filter((a,o,l)=>l.indexOf(a)===o),score:c(this,we)}}),n}search(e,t){var o;const r=[];y(this,j,Se);let s=[this];const i=fr(t),a=[];for(let l=0,u=i.length;l<u;l++){const f=i[l],d=l===u-1,h=[];for(let m=0,E=s.length;m<E;m++){const p=s[m],w=c(p,N)[f];w&&(y(w,j,c(p,j)),d?(c(w,N)["*"]&&r.push(...A(this,K,se).call(this,c(w,N)["*"],e,c(p,j))),r.push(...A(this,K,se).call(this,w,e,c(p,j)))):h.push(w));for(let R=0,x=c(p,le).length;R<x;R++){const C=c(p,le)[R],S=c(p,j)===Se?{}:{...c(p,j)};if(C==="*"){const G=c(p,N)["*"];G&&(r.push(...A(this,K,se).call(this,G,e,c(p,j))),y(G,j,S),h.push(G));continue}const[T,ue,re]=C;if(!f&&!(re instanceof RegExp))continue;const F=c(p,N)[T],Dr=i.slice(l).join("/");if(re instanceof RegExp){const G=re.exec(Dr);if(G){if(S[ue]=G[0],r.push(...A(this,K,se).call(this,F,e,c(p,j),S)),Object.keys(c(F,N)).length){y(F,j,S);const rt=((o=G[0].match(/\//))==null?void 0:o.length)??0;(a[rt]||(a[rt]=[])).push(F)}continue}}(re===!0||re.test(f))&&(S[ue]=f,d?(r.push(...A(this,K,se).call(this,F,e,S,c(p,j))),c(F,N)["*"]&&r.push(...A(this,K,se).call(this,c(F,N)["*"],e,S,c(p,j)))):(y(F,j,S),h.push(F)))}}s=h.concat(a.shift()??[])}return r.length>1&&r.sort((l,u)=>l.score-u.score),[r.map(({handler:l,params:u})=>[l,u])]}},ee=new WeakMap,N=new WeakMap,le=new WeakMap,we=new WeakMap,j=new WeakMap,K=new WeakSet,se=function(e,t,r,n){const s=[];for(let i=0,a=c(e,ee).length;i<a;i++){const o=c(e,ee)[i],l=o[t]||o[k],u={};if(l!==void 0&&(l.params=Object.create(null),s.push(l),r!==Se||n&&n!==Se))for(let f=0,d=l.possibleKeys.length;f<d;f++){const h=l.possibleKeys[f],m=u[l.score];l.params[h]=n!=null&&n[h]&&!m?n[h]:r[h]??(n==null?void 0:n[h]),u[l.score]=!0}}return s},Yt),ce,Qt,Nn=(Qt=class{constructor(){g(this,"name","TrieRouter");b(this,ce);y(this,ce,new Cr)}add(e,t,r){const n=dr(t);if(n){for(let s=0,i=n.length;s<i;s++)c(this,ce).insert(e,n[s],r);return}c(this,ce).insert(e,t,r)}match(e,t){return c(this,ce).search(e,t)}},ce=new WeakMap,Qt),Or=class extends br{constructor(e={}){super(e),this.router=e.router??new Tn({routers:[new jn,new Nn]})}},$n=e=>{const r={...{origin:"*",allowMethods:["GET","HEAD","PUT","POST","DELETE","PATCH"],allowHeaders:[],exposeHeaders:[]},...e},n=(i=>typeof i=="string"?i==="*"?()=>i:a=>i===a?a:null:typeof i=="function"?i:a=>i.includes(a)?a:null)(r.origin),s=(i=>typeof i=="function"?i:Array.isArray(i)?()=>i:()=>[])(r.allowMethods);return async function(a,o){var f;function l(d,h){a.res.headers.set(d,h)}const u=await n(a.req.header("origin")||"",a);if(u&&l("Access-Control-Allow-Origin",u),r.credentials&&l("Access-Control-Allow-Credentials","true"),(f=r.exposeHeaders)!=null&&f.length&&l("Access-Control-Expose-Headers",r.exposeHeaders.join(",")),a.req.method==="OPTIONS"){r.origin!=="*"&&l("Vary","Origin"),r.maxAge!=null&&l("Access-Control-Max-Age",r.maxAge.toString());const d=await s(a.req.header("origin")||"",a);d.length&&l("Access-Control-Allow-Methods",d.join(","));let h=r.allowHeaders;if(!(h!=null&&h.length)){const m=a.req.header("Access-Control-Request-Headers");m&&(h=m.split(/\s*,\s*/))}return h!=null&&h.length&&(l("Access-Control-Allow-Headers",h.join(",")),a.res.headers.append("Vary","Access-Control-Request-Headers")),a.res.headers.delete("Content-Length"),a.res.headers.delete("Content-Type"),new Response(null,{headers:a.res.headers,status:204,statusText:"No Content"})}await o(),r.origin!=="*"&&a.header("Vary","Origin",{append:!0})}},Pe="_hp",Ln={Change:"Input",DoubleClick:"DblClick"},_n={svg:"2000/svg",math:"1998/Math/MathML"},je=[],gt=new WeakMap,Re=void 0,Mn=()=>Re,q=e=>"t"in e,lt={onClick:["click",!1]},Mt=e=>{if(!e.startsWith("on"))return;if(lt[e])return lt[e];const t=e.match(/^on([A-Z][a-zA-Z]+?(?:PointerCapture)?)(Capture)?$/);if(t){const[,r,n]=t;return lt[e]=[(Ln[r]||r).toLowerCase(),!!n]}},Dt=(e,t)=>Re&&e instanceof SVGElement&&/[A-Z]/.test(t)&&(t in e.style||t.match(/^(?:o|pai|str|u|ve)/))?t.replace(/([A-Z])/g,"-$1").toLowerCase():t,Dn=(e,t,r)=>{var n;t||(t={});for(let s in t){const i=t[s];if(s!=="children"&&(!r||r[s]!==i)){s=Ye(s);const a=Mt(s);if(a){if((r==null?void 0:r[s])!==i&&(r&&e.removeEventListener(a[0],r[s],a[1]),i!=null)){if(typeof i!="function")throw new Error(`Event handler for "${s}" is not a function`);e.addEventListener(a[0],i,a[1])}}else if(s==="dangerouslySetInnerHTML"&&i)e.innerHTML=i.__html;else if(s==="ref"){let o;typeof i=="function"?o=i(e)||(()=>i(null)):i&&"current"in i&&(i.current=e,o=()=>i.current=null),gt.set(e,o)}else if(s==="style"){const o=e.style;typeof i=="string"?o.cssText=i:(o.cssText="",i!=null&&cr(i,o.setProperty.bind(o)))}else{if(s==="value"){const l=e.nodeName;if(l==="INPUT"||l==="TEXTAREA"||l==="SELECT"){if(e.value=i==null||i===!1?null:i,l==="TEXTAREA"){e.textContent=i;continue}else if(l==="SELECT"){e.selectedIndex===-1&&(e.selectedIndex=0);continue}}}else(s==="checked"&&e.nodeName==="INPUT"||s==="selected"&&e.nodeName==="OPTION")&&(e[s]=i);const o=Dt(e,s);i==null||i===!1?e.removeAttribute(o):i===!0?e.setAttribute(o,""):typeof i=="string"||typeof i=="number"?e.setAttribute(o,i):e.setAttribute(o,i.toString())}}}if(r)for(let s in r){const i=r[s];if(s!=="children"&&!(s in t)){s=Ye(s);const a=Mt(s);a?e.removeEventListener(a[0],i,a[1]):s==="ref"?(n=gt.get(e))==null||n():e.removeAttribute(Dt(e,s))}}},Hn=(e,t)=>{t[O][0]=0,je.push([e,t]);const r=t.tag[Et]||t.tag,n=r.defaultProps?{...r.defaultProps,...t.props}:t.props;try{return[r.call(null,n)]}finally{je.pop()}},kr=(e,t,r,n,s)=>{var i,a;(i=e.vR)!=null&&i.length&&(n.push(...e.vR),delete e.vR),typeof e.tag=="function"&&((a=e[O][1][Nr])==null||a.forEach(o=>s.push(o))),e.vC.forEach(o=>{var l;if(q(o))r.push(o);else if(typeof o.tag=="function"||o.tag===""){o.c=t;const u=r.length;if(kr(o,t,r,n,s),o.s){for(let f=u;f<r.length;f++)r[f].s=!0;o.s=!1}}else r.push(o),(l=o.vR)!=null&&l.length&&(n.push(...o.vR),delete o.vR)})},In=e=>{for(;;e=e.tag===Pe||!e.vC||!e.pP?e.nN:e.vC[0]){if(!e)return null;if(e.tag!==Pe&&e.e)return e.e}},Pr=e=>{var t,r,n,s,i,a;q(e)||((r=(t=e[O])==null?void 0:t[1][Nr])==null||r.forEach(o=>{var l;return(l=o[2])==null?void 0:l.call(o)}),(n=gt.get(e.e))==null||n(),e.p===2&&((s=e.vC)==null||s.forEach(o=>o.p=2)),(i=e.vC)==null||i.forEach(Pr)),e.p||((a=e.e)==null||a.remove(),delete e.e),typeof e.tag=="function"&&(Ae.delete(e),Xe.delete(e),delete e[O][3],e.a=!0)},jr=(e,t,r)=>{e.c=t,Tr(e,t,r)},Ht=(e,t)=>{if(t){for(let r=0,n=e.length;r<n;r++)if(e[r]===t)return r}},It=Symbol(),Tr=(e,t,r)=>{var u;const n=[],s=[],i=[];kr(e,t,n,s,i),s.forEach(Pr);const a=r?void 0:t.childNodes;let o,l=null;if(r)o=-1;else if(!a.length)o=0;else{const f=Ht(a,In(e.nN));f!==void 0?(l=a[f],o=f):o=Ht(a,(u=n.find(d=>d.tag!==Pe&&d.e))==null?void 0:u.e)??-1,o===-1&&(r=!0)}for(let f=0,d=n.length;f<d;f++,o++){const h=n[f];let m;if(h.s&&h.e)m=h.e,h.s=!1;else{const E=r||!h.e;q(h)?(h.e&&h.d&&(h.e.textContent=h.t),h.d=!1,m=h.e||(h.e=document.createTextNode(h.t))):(m=h.e||(h.e=h.n?document.createElementNS(h.n,h.tag):document.createElement(h.tag)),Dn(m,h.props,h.pP),Tr(h,m,E))}h.tag===Pe?o--:r?m.parentNode||t.appendChild(m):a[o]!==m&&a[o-1]!==m&&(a[o+1]===m?t.appendChild(a[o]):t.insertBefore(m,l||a[o]||null))}if(e.pP&&delete e.pP,i.length){const f=[],d=[];i.forEach(([,h,,m,E])=>{h&&f.push(h),m&&d.push(m),E==null||E()}),f.forEach(h=>h()),d.length&&requestAnimationFrame(()=>{d.forEach(h=>h())})}},Fn=(e,t)=>!!(e&&e.length===t.length&&e.every((r,n)=>r[1]===t[n][1])),Xe=new WeakMap,yt=(e,t,r)=>{var i,a,o,l,u,f;const n=!r&&t.pC;r&&(t.pC||(t.pC=t.vC));let s;try{r||(r=typeof t.tag=="function"?Hn(e,t):De(t.props.children)),((i=r[0])==null?void 0:i.tag)===""&&r[0][dt]&&(s=r[0][dt],e[5].push([e,s,t]));const d=n?[...t.pC]:t.vC?[...t.vC]:void 0,h=[];let m;for(let E=0;E<r.length;E++){Array.isArray(r[E])&&r.splice(E,1,...r[E].flat());let p=qn(r[E]);if(p){typeof p.tag=="function"&&!p.tag[sr]&&(be.length>0&&(p[O][2]=be.map(R=>[R,R.values.at(-1)])),(a=e[5])!=null&&a.length&&(p[O][3]=e[5].at(-1)));let w;if(d&&d.length){const R=d.findIndex(q(p)?x=>q(x):p.key!==void 0?x=>x.key===p.key&&x.tag===p.tag:x=>x.tag===p.tag);R!==-1&&(w=d[R],d.splice(R,1))}if(w)if(q(p))w.t!==p.t&&(w.t=p.t,w.d=!0),p=w;else{const R=w.pP=w.props;if(w.props=p.props,w.f||(w.f=p.f||t.f),typeof p.tag=="function"){const x=w[O][2];w[O][2]=p[O][2]||[],w[O][3]=p[O][3],!w.f&&((w.o||w)===p.o||(l=(o=w.tag)[Br])!=null&&l.call(o,R,w.props))&&Fn(x,w[O][2])&&(w.s=!0)}p=w}else if(!q(p)&&Re){const R=xe(Re);R&&(p.n=R)}if(!q(p)&&!p.s&&(yt(e,p),delete p.f),h.push(p),m&&!m.s&&!p.s)for(let R=m;R&&!q(R);R=(u=R.vC)==null?void 0:u.at(-1))R.nN=p;m=p}}t.vR=n?[...t.vC,...d||[]]:d||[],t.vC=h,n&&delete t.pC}catch(d){if(t.f=!0,d===It){if(s)return;throw d}const[h,m,E]=((f=t[O])==null?void 0:f[3])||[];if(m){const p=()=>Je([0,!1,e[2]],E),w=Xe.get(E)||[];w.push(p),Xe.set(E,w);const R=m(d,()=>{const x=Xe.get(E);if(x){const C=x.indexOf(p);if(C!==-1)return x.splice(C,1),p()}});if(R){if(e[0]===1)e[1]=!0;else if(yt(e,E,[R]),(m.length===1||e!==h)&&E.c){jr(E,E.c,!1);return}throw It}}throw d}finally{s&&e[5].pop()}},qn=e=>{if(!(e==null||typeof e=="boolean")){if(typeof e=="string"||typeof e=="number")return{t:e.toString(),d:!0};if("vR"in e&&(e={tag:e.tag,props:e.props,key:e.key,f:e.f,type:e.tag,ref:e.props.ref,o:e.o||e}),typeof e.tag=="function")e[O]=[0,[]];else{const t=_n[e.tag];t&&(Re||(Re=ar("")),e.props.children=[{tag:Re,props:{value:e.n=`http://www.w3.org/${t}`,children:e.props.children}}])}return e}},Ft=(e,t)=>{var r,n;(r=t[O][2])==null||r.forEach(([s,i])=>{s.values.push(i)});try{yt(e,t,void 0)}catch{return}if(t.a){delete t.a;return}(n=t[O][2])==null||n.forEach(([s])=>{s.values.pop()}),(e[0]!==1||!e[1])&&jr(t,t.c,!1)},Ae=new WeakMap,qt=[],Je=async(e,t)=>{e[5]||(e[5]=[]);const r=Ae.get(t);r&&r[0](void 0);let n;const s=new Promise(i=>n=i);if(Ae.set(t,[n,()=>{e[2]?e[2](e,t,i=>{Ft(i,t)}).then(()=>n(t)):(Ft(e,t),n(t))}]),qt.length)qt.at(-1).add(t);else{await Promise.resolve();const i=Ae.get(t);i&&(Ae.delete(t),i[1]())}return s},Bn=(e,t,r)=>({tag:Pe,props:{children:e},key:r,e:t,p:1}),ct=0,Nr=1,ut=2,ft=3,ht=new WeakMap,$r=(e,t)=>!e||!t||e.length!==t.length||t.some((r,n)=>r!==e[n]),Un=void 0,Bt=[],Wn=e=>{var a;const t=()=>typeof e=="function"?e():e,r=je.at(-1);if(!r)return[t(),()=>{}];const[,n]=r,s=(a=n[O][1])[ct]||(a[ct]=[]),i=n[O][0]++;return s[i]||(s[i]=[t(),o=>{const l=Un,u=s[i];if(typeof o=="function"&&(o=o(u[0])),!Object.is(o,u[0]))if(u[0]=o,Bt.length){const[f,d]=Bt.at(-1);Promise.all([f===3?n:Je([f,!1,l],n),d]).then(([h])=>{if(!h||!(f===2||f===3))return;const m=h.vC;requestAnimationFrame(()=>{setTimeout(()=>{m===h.vC&&Je([f===3?1:0,!1,l],h)})})})}else Je([0,!1,l],n)}])},St=(e,t)=>{var o;const r=je.at(-1);if(!r)return e;const[,n]=r,s=(o=n[O][1])[ut]||(o[ut]=[]),i=n[O][0]++,a=s[i];return $r(a==null?void 0:a[1],t)?s[i]=[e,t]:e=s[i][0],e},Kn=e=>{const t=ht.get(e);if(t){if(t.length===2)throw t[1];return t[0]}throw e.then(r=>ht.set(e,[r]),r=>ht.set(e,[void 0,r])),e},Vn=(e,t)=>{var o;const r=je.at(-1);if(!r)return e();const[,n]=r,s=(o=n[O][1])[ft]||(o[ft]=[]),i=n[O][0]++,a=s[i];return $r(a==null?void 0:a[1],t)&&(s[i]=[e(),t]),s[i][0]},zn=ar({pending:!1,data:null,method:null,action:null}),Ut=new Set,Gn=e=>{Ut.add(e),e.finally(()=>Ut.delete(e))},At=(e,t)=>Vn(()=>r=>{let n;e&&(typeof e=="function"?n=e(r)||(()=>{e(null)}):e&&"current"in e&&(e.current=r,n=()=>{e.current=null}));const s=t(r);return()=>{s==null||s(),n==null||n()}},[e]),he=Object.create(null),Be=Object.create(null),Fe=(e,t,r,n,s)=>{if(t!=null&&t.itemProp)return{tag:e,props:t,type:e,ref:t.ref};const i=document.head;let{onLoad:a,onError:o,precedence:l,blocking:u,...f}=t,d=null,h=!1;const m=Ue[e];let E;if(m.length>0){const x=i.querySelectorAll(e);e:for(const C of x)for(const S of Ue[e])if(C.getAttribute(S)===t[S]){d=C;break e}if(!d){const C=m.reduce((S,T)=>t[T]===void 0?S:`${S}-${T}-${t[T]}`,e);h=!Be[C],d=Be[C]||(Be[C]=(()=>{const S=document.createElement(e);for(const T of m)t[T]!==void 0&&S.setAttribute(T,t[T]),t.rel&&S.setAttribute("rel",t.rel);return S})())}}else E=i.querySelectorAll(e);l=n?l??"":void 0,n&&(f[We]=l);const p=St(x=>{if(m.length>0){let C=!1;for(const S of i.querySelectorAll(e)){if(C&&S.getAttribute(We)!==l){i.insertBefore(x,S);return}S.getAttribute(We)===l&&(C=!0)}i.appendChild(x)}else if(E){let C=!1;for(const S of E)if(S===x){C=!0;break}C||i.insertBefore(x,i.contains(E[0])?E[0]:i.querySelector(e)),E=void 0}},[l]),w=At(t.ref,x=>{var T;const C=m[0];if(r===2&&(x.innerHTML=""),(h||E)&&p(x),!o&&!a)return;let S=he[T=x.getAttribute(C)]||(he[T]=new Promise((ue,re)=>{x.addEventListener("load",ue),x.addEventListener("error",re)}));a&&(S=S.then(a)),o&&(S=S.catch(o)),S.catch(()=>{})});if(s&&u==="render"){const x=Ue[e][0];if(t[x]){const C=t[x],S=he[C]||(he[C]=new Promise((T,ue)=>{p(d),d.addEventListener("load",T),d.addEventListener("error",ue)}));Kn(S)}}const R={tag:e,type:e,props:{...f,ref:w},ref:w};return R.p=r,d&&(R.e=d),Bn(R,i)},Xn=e=>{const t=Mn(),r=t&&xe(t);return r!=null&&r.endsWith("svg")?{tag:"title",props:e,type:"title",ref:e.ref}:Fe("title",e,void 0,!1,!1)},Jn=e=>!e||["src","async"].some(t=>!e[t])?{tag:"script",props:e,type:"script",ref:e.ref}:Fe("script",e,1,!1,!0),Zn=e=>!e||!["href","precedence"].every(t=>t in e)?{tag:"style",props:e,type:"style",ref:e.ref}:(e["data-href"]=e.href,delete e.href,Fe("style",e,2,!0,!0)),Yn=e=>!e||["onLoad","onError"].some(t=>t in e)||e.rel==="stylesheet"&&(!("precedence"in e)||"disabled"in e)?{tag:"link",props:e,type:"link",ref:e.ref}:Fe("link",e,1,"precedence"in e,!0),Qn=e=>Fe("meta",e,void 0,!1,!1),Lr=Symbol(),es=e=>{const{action:t,...r}=e;typeof t!="function"&&(r.action=t);const[n,s]=Wn([null,!1]),i=St(async u=>{const f=u.isTrusted?t:u.detail[Lr];if(typeof f!="function")return;u.preventDefault();const d=new FormData(u.target);s([d,!0]);const h=f(d);h instanceof Promise&&(Gn(h),await h),s([null,!0])},[]),a=At(e.ref,u=>(u.addEventListener("submit",i),()=>{u.removeEventListener("submit",i)})),[o,l]=n;return n[1]=!1,{tag:zn,props:{value:{pending:o!==null,data:o,method:o?"post":null,action:o?t:null},children:{tag:"form",props:{...r,ref:a},type:"form",ref:a}},f:l}},_r=(e,{formAction:t,...r})=>{if(typeof t=="function"){const n=St(s=>{s.preventDefault(),s.currentTarget.form.dispatchEvent(new CustomEvent("submit",{detail:{[Lr]:t}}))},[]);r.ref=At(r.ref,s=>(s.addEventListener("click",n),()=>{s.removeEventListener("click",n)}))}return{tag:e,props:r,type:e,ref:r.ref}},ts=e=>_r("input",e),rs=e=>_r("button",e);Object.assign(vt,{title:Xn,script:Jn,style:Zn,link:Yn,meta:Qn,form:es,input:ts,button:rs});wt(null);new TextEncoder;var ns=wt(null),ss=(e,t,r,n)=>(s,i)=>{const a="<!DOCTYPE html>",o=r?Tt(u=>r(u,e),{Layout:t,...i},s):s,l=qr`${_(a)}${Tt(ns.Provider,{value:e},o)}`;return e.html(l)},is=(e,t)=>function(n,s){const i=n.getLayout()??tn;return e&&n.setLayout(a=>e({...a,Layout:i},n)),n.setRenderer(ss(n,i,e)),s()};const as=is(({children:e})=>v("html",{lang:"ja",children:[v("head",{children:[v("meta",{charset:"UTF-8"}),v("meta",{name:"viewport",content:"width=device-width, initial-scale=1.0"}),v("title",{children:"ãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ« ãƒã‚±ãƒƒãƒˆç®¡ç†"}),v("script",{src:"https://cdn.tailwindcss.com"}),v("link",{href:"/static/style.css",rel:"stylesheet"})]}),v("body",{children:e})]})),z=new Or;z.use("/api/*",$n());z.use(as);async function os(e,t,r,n){if(!e){console.log("LINE_CHANNEL_ACCESS_TOKEN is not set. Skipping LINE notification.");return}const s=r>0?`ã€ãƒã‚±ãƒƒãƒˆè¿½åŠ ã€‘
${t}æ§˜
ãƒã‚±ãƒƒãƒˆã‚’${r}æžšè¿½åŠ ã—ã¾ã—ãŸã€‚
æ®‹ã‚Š: ${n}æžš`:`ã€ãƒã‚±ãƒƒãƒˆä½¿ç”¨ã€‘
${t}æ§˜
ãƒã‚±ãƒƒãƒˆã‚’${Math.abs(r)}æžšä½¿ç”¨ã—ã¾ã—ãŸã€‚
æ®‹ã‚Š: ${n}æžš`;try{const i=await fetch("https://api.line.me/v2/bot/message/broadcast",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({messages:[{type:"text",text:s}]})});i.ok||console.error("LINE notification failed:",await i.text())}catch(i){console.error("LINE notification error:",i)}}z.get("/api/customers",async e=>{try{const{results:t}=await e.env.DB.prepare("SELECT * FROM customers ORDER BY name ASC").all();return e.json({customers:t})}catch{return e.json({error:"Failed to fetch customers"},500)}});z.get("/api/customers/:id",async e=>{const t=e.req.param("id");try{const r=await e.env.DB.prepare("SELECT * FROM customers WHERE id = ?").bind(t).first();if(!r)return e.json({error:"Customer not found"},404);const{results:n}=await e.env.DB.prepare("SELECT * FROM ticket_history WHERE customer_id = ? ORDER BY created_at DESC").bind(t).all();return e.json({customer:r,history:n})}catch{return e.json({error:"Failed to fetch customer"},500)}});z.post("/api/customers",async e=>{try{const{name:t,phone:r,email:n,ticket_count:s}=await e.req.json();if(!t)return e.json({error:"Name is required"},400);const a=(await e.env.DB.prepare("INSERT INTO customers (name, phone, email, ticket_count) VALUES (?, ?, ?, ?)").bind(t,r||null,n||null,s||0).run()).meta.last_row_id;return s&&s>0&&await e.env.DB.prepare("INSERT INTO ticket_history (customer_id, change_amount, previous_count, new_count, note) VALUES (?, ?, ?, ?, ?)").bind(a,s,0,s,"åˆå›žç™»éŒ²").run(),e.json({id:a,name:t,phone:r,email:n,ticket_count:s||0})}catch{return e.json({error:"Failed to create customer"},500)}});z.post("/api/customers/:id/tickets",async e=>{const t=e.req.param("id");try{const{change_amount:r,note:n}=await e.req.json();if(r===void 0||r===0)return e.json({error:"change_amount is required and must not be zero"},400);const s=await e.env.DB.prepare("SELECT * FROM customers WHERE id = ?").bind(t).first();if(!s)return e.json({error:"Customer not found"},404);const i=s.ticket_count,a=i+r;return a<0?e.json({error:"Insufficient tickets"},400):(await e.env.DB.prepare("UPDATE customers SET ticket_count = ?, updated_at = CURRENT_TIMESTAMP WHERE id = ?").bind(a,t).run(),await e.env.DB.prepare("INSERT INTO ticket_history (customer_id, change_amount, previous_count, new_count, note) VALUES (?, ?, ?, ?, ?)").bind(t,r,i,a,n||null).run(),await os(e.env.LINE_CHANNEL_ACCESS_TOKEN,s.name,r,a),e.json({customer_id:t,previous_count:i,change_amount:r,new_count:a}))}catch(r){return console.error("Ticket update error:",r),e.json({error:"Failed to update tickets"},500)}});z.delete("/api/customers/:id",async e=>{const t=e.req.param("id");try{return await e.env.DB.prepare("DELETE FROM customers WHERE id = ?").bind(t).run(),e.json({success:!0})}catch{return e.json({error:"Failed to delete customer"},500)}});z.get("/",e=>e.render(v("div",{class:"container",children:[v("header",{children:v("h1",{children:"ðŸŽ« ãƒ€ãƒ³ã‚¹ã‚¹ã‚¯ãƒ¼ãƒ« ãƒã‚±ãƒƒãƒˆç®¡ç†"})}),v("div",{class:"main-content",children:[v("div",{class:"section",children:[v("div",{class:"section-header",children:[v("h2",{children:"é¡§å®¢ä¸€è¦§"}),v("button",{onclick:"showAddCustomerModal()",class:"btn btn-primary",children:"âž• æ–°è¦é¡§å®¢ç™»éŒ²"})]}),v("div",{id:"customerList",class:"customer-list",children:v("p",{class:"loading",children:"èª­ã¿è¾¼ã¿ä¸­..."})})]}),v("div",{class:"section",id:"customerDetailSection",style:"display: none;",children:[v("div",{class:"section-header",children:[v("h2",{children:"é¡§å®¢è©³ç´°"}),v("button",{onclick:"closeCustomerDetail()",class:"btn btn-secondary",children:"âœ• é–‰ã˜ã‚‹"})]}),v("div",{id:"customerDetail"})]})]}),v("div",{id:"addCustomerModal",class:"modal",children:v("div",{class:"modal-content",children:[v("div",{class:"modal-header",children:[v("h3",{children:"æ–°è¦é¡§å®¢ç™»éŒ²"}),v("button",{onclick:"closeAddCustomerModal()",class:"btn btn-text",children:"âœ•"})]}),v("form",{id:"addCustomerForm",children:[v("div",{class:"form-group",children:[v("label",{children:"æ°å *"}),v("input",{type:"text",name:"name",required:!0})]}),v("div",{class:"form-group",children:[v("label",{children:"é›»è©±ç•ªå·"}),v("input",{type:"tel",name:"phone"})]}),v("div",{class:"form-group",children:[v("label",{children:"ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹"}),v("input",{type:"email",name:"email"})]}),v("div",{class:"form-group",children:[v("label",{children:"åˆæœŸãƒã‚±ãƒƒãƒˆæžšæ•°"}),v("input",{type:"number",name:"ticket_count",min:"0",value:"0"})]}),v("div",{class:"form-actions",children:[v("button",{type:"button",onclick:"closeAddCustomerModal()",class:"btn btn-secondary",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),v("button",{type:"submit",class:"btn btn-primary",children:"ç™»éŒ²"})]})]})]})}),v("div",{id:"ticketModal",class:"modal",children:v("div",{class:"modal-content",children:[v("div",{class:"modal-header",children:[v("h3",{children:"ãƒã‚±ãƒƒãƒˆå¢—æ¸›"}),v("button",{onclick:"closeTicketModal()",class:"btn btn-text",children:"âœ•"})]}),v("form",{id:"ticketForm",children:[v("input",{type:"hidden",id:"ticketCustomerId"}),v("div",{class:"form-group",children:[v("label",{children:"å¤‰æ›´æžšæ•°"}),v("input",{type:"number",id:"ticketChangeAmount",name:"change_amount",required:!0,placeholder:"æ­£ã®æ•°ã§è¿½åŠ ã€è² ã®æ•°ã§æ¸›å°‘"})]}),v("div",{class:"form-group",children:[v("label",{children:"ãƒ¡ãƒ¢"}),v("textarea",{name:"note",rows:"3",placeholder:"ä¾‹: 10å›žãƒã‚±ãƒƒãƒˆè³¼å…¥"})]}),v("div",{class:"form-actions",children:[v("button",{type:"button",onclick:"closeTicketModal()",class:"btn btn-secondary",children:"ã‚­ãƒ£ãƒ³ã‚»ãƒ«"}),v("button",{type:"submit",class:"btn btn-primary",children:"æ›´æ–°"})]})]})]})}),v("script",{src:"/static/app.js"})]})));const Wt=new Or,ls=Object.assign({"/src/index.tsx":z});let Mr=!1;for(const[,e]of Object.entries(ls))e&&(Wt.all("*",t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Wt.notFound(t=>{let r;try{r=t.executionCtx}catch{}return e.fetch(t.req.raw,t.env,r)}),Mr=!0);if(!Mr)throw new Error("Can't import modules from ['/src/index.ts','/src/index.tsx','/app/server.ts']");export{Wt as default};
